#N canvas 477 63 722 443 10;
#X obj 13 301 t a a;
#N canvas 534 208 602 277 depthBuffer(tex2) 0;
#X obj 15 116 gemframebuffer;
#X obj 15 145 translateXYZ 0 0 -4;
#X obj 15 27 inlet;
#X obj 15 254 outlet;
#X obj 293 207 gemhead;
#X msg 149 227 focalDistance -0.07;
#X msg 31 89 rectangle 1;
#X obj 31 67 loadbang;
#X obj 363 46 loadbang;
#X obj 347 22 gemhead;
#N canvas 0 22 805 535 vBlurPass.2 0;
#X obj 202 94 gemhead;
#X obj 204 235 pix_texture;
#X obj 202 156 gemframebuffer;
#X obj 203 181 translateXYZ 0 0 -4;
#X obj 204 259 square 4;
#X obj 93 140 inlet;
#X obj 423 203 outlet;
#X msg 263 72 rectangle 1;
#X obj 259 36 loadbang;
#X msg 324 207 amount 0 5;
#X obj 204 208 pix_shader vBlur 2;
#X connect 0 0 2 0;
#X connect 1 0 4 0;
#X connect 2 0 3 0;
#X connect 2 1 6 0;
#X connect 3 0 10 0;
#X connect 5 0 1 1;
#X connect 7 0 2 0;
#X connect 8 0 7 0;
#X connect 9 0 10 1;
#X connect 10 0 1 0;
#X connect 10 1 9 0;
#X restore 197 127 pd vBlurPass.2;
#X obj 347 100 gemframebuffer;
#X obj 347 148 pix_texture;
#X obj 347 171 square 4;
#X obj 347 124 translateXYZ 0 0 -4;
#N canvas 0 22 805 535 vBlurPass.3 0;
#X obj 202 94 gemhead;
#X obj 204 235 pix_texture;
#X obj 202 156 gemframebuffer;
#X obj 203 181 translateXYZ 0 0 -4;
#X obj 204 259 square 4;
#X obj 93 140 inlet;
#X obj 423 203 outlet;
#X msg 273 104 rectangle 1;
#X obj 273 76 loadbang;
#X msg 324 207 amount 5 0;
#X obj 204 208 pix_shader vBlur 3;
#X connect 0 0 2 0;
#X connect 1 0 4 0;
#X connect 2 0 3 0;
#X connect 2 1 6 0;
#X connect 3 0 10 0;
#X connect 5 0 1 1;
#X connect 7 0 2 0;
#X connect 8 0 7 0;
#X connect 9 0 10 1;
#X connect 10 0 1 0;
#X connect 10 1 9 0;
#X restore 197 148 pd vBlurPass.3;
#N canvas 0 22 805 535 vBlurPass.4 0;
#X obj 202 94 gemhead;
#X obj 204 235 pix_texture;
#X obj 202 156 gemframebuffer;
#X obj 203 181 translateXYZ 0 0 -4;
#X obj 204 259 square 4;
#X obj 93 140 inlet;
#X obj 423 203 outlet;
#X msg 269 72 rectangle 1;
#X obj 268 47 loadbang;
#X msg 326 206 amount 0 5;
#X obj 204 208 pix_shader vBlur 4;
#X connect 0 0 2 0;
#X connect 1 0 4 0;
#X connect 2 0 3 0;
#X connect 2 1 6 0;
#X connect 3 0 10 0;
#X connect 5 0 1 1;
#X connect 7 0 2 0;
#X connect 8 0 7 0;
#X connect 9 0 10 1;
#X connect 10 0 1 0;
#X connect 10 1 9 0;
#X restore 197 169 pd vBlurPass.4;
#N canvas 483 180 805 535 vBlurPass.1 0;
#X obj 202 94 gemhead;
#X obj 204 235 pix_texture;
#X obj 202 156 gemframebuffer;
#X obj 203 181 translateXYZ 0 0 -4;
#X obj 204 259 square 4;
#X obj 93 140 inlet;
#X obj 423 203 outlet;
#X msg 288 116 rectangle 1;
#X obj 284 80 loadbang;
#X msg 324 207 amount 5 0;
#X obj 204 208 pix_shader vBlur 1;
#X connect 0 0 2 0;
#X connect 1 0 4 0;
#X connect 2 0 3 0;
#X connect 2 1 6 0;
#X connect 3 0 10 0;
#X connect 5 0 1 1;
#X connect 7 0 2 0;
#X connect 8 0 7 0;
#X connect 9 0 10 1;
#X connect 10 0 1 0;
#X connect 10 1 9 0;
#X restore 197 107 pd vBlurPass.1;
#X text 192 41 to smooth the depth;
#N canvas 482 249 482 519 previewWindow[depth] 0;
#X obj 49 32 inlet;
#X obj 49 175 translateXYZ 4.02 -2.54 0;
#X obj 49 149 pix_texture;
#X obj 112 112 inlet;
#X obj 81 63 loadbang;
#X obj 49 198 square 1.2;
#X obj 50 418 text3d;
#X obj 50 245 gemhead;
#X msg 98 381 3;
#X obj 169 322 loadbang;
#X obj 50 301 color 1 1 1;
#X obj 169 342 t b b b;
#X obj 50 277 translateXYZ 4 -3.84 0;
#X obj 126 301 r texunit2.label;
#X msg 134 382 text TEXUNIT 2;
#X msg 81 85 rectangle 1;
#X msg 66 359 font vera.ttf;
#X connect 0 0 2 0;
#X connect 1 0 5 0;
#X connect 2 0 1 0;
#X connect 3 0 2 1;
#X connect 4 0 15 0;
#X connect 7 0 12 0;
#X connect 8 0 6 1;
#X connect 9 0 11 0;
#X connect 10 0 6 0;
#X connect 11 0 14 0;
#X connect 11 1 8 0;
#X connect 11 2 16 0;
#X connect 12 0 10 0;
#X connect 13 0 10 1;
#X connect 14 0 6 0;
#X connect 15 0 2 0;
#X connect 16 0 6 0;
#X restore 293 229 pd previewWindow[depth];
#X text 193 58 map. This might be;
#X text 28 176 1 This shader generates;
#X text 192 26 2 Four blur passes;
#X text 441 168 to texunit 2 and sent;
#X text 441 185 to the preview window;
#X text 27 192 the depth map;
#X text 442 151 3 Finally render;
#X obj 15 227 pix_shader zBuffer 1;
#X text 192 75 crazy but works!;
#X msg 363 69 mode 0 \, dimen 500 500 \, texunit 2;
#X connect 0 0 1 0;
#X connect 0 1 17 0;
#X connect 1 0 27 0;
#X connect 2 0 0 0;
#X connect 4 0 19 0;
#X connect 5 0 27 1;
#X connect 6 0 0 0;
#X connect 7 0 6 0;
#X connect 8 0 29 0;
#X connect 9 0 11 0;
#X connect 10 0 15 0;
#X connect 11 0 14 0;
#X connect 11 1 19 1;
#X connect 12 0 13 0;
#X connect 14 0 12 0;
#X connect 15 0 16 0;
#X connect 16 0 12 1;
#X connect 17 0 10 0;
#X connect 27 0 3 0;
#X connect 27 1 5 0;
#X connect 29 0 11 0;
#X restore 13 329 pd depthBuffer(tex2);
#N canvas 839 313 455 236 sceneBuffer(tex1) 0;
#X obj 10 139 gemframebuffer;
#X obj 63 63 loadbang;
#X obj 10 164 translateXYZ 0 0 -4;
#X obj 10 4 inlet;
#X obj 10 195 outlet;
#N canvas 795 295 488 428 previewWindow[scene] 0;
#X obj 51 45 gemhead;
#X obj 51 68 pix_texture;
#X obj 51 92 translateXYZ 4.02 2.81 0;
#X obj 243 20 pix_coordinate;
#X obj 335 -10 loadbang;
#X obj 138 28 inlet;
#X obj 93 328 text3d;
#X obj 93 155 gemhead;
#X msg 141 291 3;
#X obj 212 232 loadbang;
#X obj 93 187 translateXYZ 4 1.51 0;
#X obj 169 211 r texunit1.label;
#X obj 93 211 color 1 1 1;
#X msg 335 11 0 1 1 1 1 0 0 0;
#X obj 51 118 square 1.2;
#X msg 177 292 text TEXUNIT 1;
#X obj 212 252 t b b b;
#X msg 109 269 font vera.ttf;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 14 0;
#X connect 4 0 13 0;
#X connect 5 0 1 1;
#X connect 7 0 10 0;
#X connect 8 0 6 1;
#X connect 9 0 16 0;
#X connect 10 0 12 0;
#X connect 11 0 12 1;
#X connect 12 0 6 0;
#X connect 13 0 3 1;
#X connect 15 0 6 0;
#X connect 16 0 15 0;
#X connect 16 1 8 0;
#X connect 16 2 17 0;
#X connect 17 0 6 0;
#X restore 108 139 pd previewWindow[scene];
#X text 61 4 Renders the scene in a framebuffer. I have upsampled the
quality from 500 to 1000 for better quality \, is it the right way
to do that?;
#X msg 63 86 mode 0 \, dimen 1000 1000 \, texunit 1;
#X connect 0 0 2 0;
#X connect 0 1 5 0;
#X connect 1 0 7 0;
#X connect 2 0 4 0;
#X connect 3 0 0 0;
#X connect 7 0 0 0;
#X restore 40 354 pd sceneBuffer(tex1);
#X obj 434 368 hradio 20 1 0 3 empty blurMask.gui empty 0 -8 0 10 -99865
-99865 -262144 0;
#N canvas 570 202 495 338 gem.init 0;
#X obj 36 96 gemwin;
#X msg 63 24 destroy;
#X obj 186 182 world_light;
#X obj 186 153 gemhead;
#X obj 36 -19 inlet;
#X obj 36 3 sel 1;
#X obj 295 251 light;
#X obj 295 152 gemhead;
#X msg 322 228 0.6 0.8 0.8;
#X obj 295 182 translateXYZ 9.5 6.4 0;
#X obj 322 207 loadbang;
#X msg 36 46 lighting 1 \, FSAA 4 \, dimen 650 500 \, title Depth-of-Field
\, color 0 0 0 \, frame 60 \, create \, 1;
#X obj 35 155 loadbang;
#X msg 35 186 \; focus.gui 0.25 \; bias.gui 0.07;
#X connect 1 0 0 0;
#X connect 3 0 2 0;
#X connect 4 0 5 0;
#X connect 5 0 11 0;
#X connect 5 1 1 0;
#X connect 7 0 9 0;
#X connect 8 0 6 1;
#X connect 9 0 6 0;
#X connect 10 0 8 0;
#X connect 11 0 0 0;
#X connect 12 0 13 0;
#X restore 37 22 pd gem.init;
#X obj 14 22 tgl 15 0 empty empty empty 17 7 0 10 -257985 -1 -1 1 1
;
#X msg 118 94 focus \$1;
#N canvas 452 237 480 485 someGeos 0;
#X obj 174 -48 inlet;
#X obj 38 305 translateXYZ 3 0 0;
#X obj 38 348 translateXYZ 3 0 0;
#X obj 194 252 translateXYZ -6 0 -3;
#X obj 330 298 translateXYZ 3 0 0;
#X obj 194 295 translateXYZ 3 0 0;
#X obj 194 347 translateXYZ 3 0 0;
#X obj 330 255 translateXYZ -6 0 -3;
#X obj 38 60 separator;
#X obj 174 -22 translateXYZ 0.2 0.3 -1;
#X obj 38 254 translateXYZ -1.2 0 1.4;
#X obj 38 228 color 0.25 0.7 0.7;
#N canvas 519 237 748 501 gem.walls 0;
#X obj 206 119 separator;
#X obj 200 203 translateXYZ 3 3 -8;
#X obj 312 117 separator;
#X obj 331 178 rotateXYZ 0 90 0;
#X obj 330 203 translateXYZ 3 3 8;
#X obj 453 183 rotateXYZ 90 0 0;
#X obj 453 205 translateXYZ 3 -3 1;
#X obj 453 231 rectangle 8 8;
#X obj 330 227 rectangle 8 5;
#X obj 200 229 rectangle 8 5;
#X obj 455 110 separator;
#X obj 203 51 inlet;
#X obj 190 156 color 0.15 0.15 0.15;
#X obj 313 141 color 0.15 0.15 0.15;
#X obj 456 134 color 0.15 0.15 0.15;
#X connect 0 0 12 0;
#X connect 1 0 9 0;
#X connect 2 0 13 0;
#X connect 3 0 4 0;
#X connect 4 0 8 0;
#X connect 5 0 6 0;
#X connect 6 0 7 0;
#X connect 10 0 14 0;
#X connect 11 0 0 0;
#X connect 11 0 2 0;
#X connect 11 0 10 0;
#X connect 12 0 1 0;
#X connect 13 0 3 0;
#X connect 14 0 5 0;
#X restore 174 33 pd gem.walls;
#X floatatom 400 322 5 0 0 0 - - -;
#X obj 330 347 translateXYZ 3 0 0;
#X obj 174 2 rotateXYZ 30 50 0;
#X obj 38 277 cube 1;
#X obj 38 327 cube 1;
#X obj 38 370 cube 1;
#X obj 194 274 cube 1;
#X obj 194 317 cube 1;
#X obj 194 369 cube 1;
#X obj 330 277 cube 1;
#X obj 330 320 cube 1;
#X obj 330 369 cube 1;
#X text 17 100 --------------------------------;
#X text 64 122 From now on is a simple gem render chain. Everything
is possible here. Particles \, geos \, recursion patch \, just try.
;
#X text 196 225 Serious laziness here :);
#N canvas 616 181 356 385 funWithParticles 0;
#X obj 43 91 part_head;
#X obj 43 320 part_render;
#X obj 43 195 part_color;
#X obj 43 244 part_gravity;
#X msg 71 144 0.25 0.7 0.7;
#X obj 43 297 part_killold 50;
#X obj 179 92 loadbang;
#X obj 70 119 loadbang;
#X msg 138 241 0 0 -0.01;
#X obj 138 218 loadbang;
#X msg 107 92 speed 0.08;
#X obj 43 67 translateXYZ 0 0 4;
#X msg 100 167 0.12 0.35 0.35;
#X obj 43 42 inlet;
#X obj 43 271 part_velocity sphere 0 0 0 0.1;
#X obj 43 220 part_source 5;
#X obj 43 345 cube 0.4;
#X connect 0 0 2 0;
#X connect 1 0 16 0;
#X connect 2 0 15 0;
#X connect 3 0 14 0;
#X connect 4 0 2 1;
#X connect 5 0 1 0;
#X connect 6 0 10 0;
#X connect 7 0 4 0;
#X connect 7 0 12 0;
#X connect 8 0 3 1;
#X connect 9 0 8 0;
#X connect 10 0 0 0;
#X connect 11 0 0 0;
#X connect 12 0 2 2;
#X connect 13 0 11 0;
#X connect 14 0 5 0;
#X connect 15 0 3 0;
#X restore 66 164 pd funWithParticles;
#X text 196 163 <- This could be a start;
#X connect 0 0 9 0;
#X connect 1 0 17 0;
#X connect 2 0 18 0;
#X connect 3 0 19 0;
#X connect 4 0 23 0;
#X connect 5 0 20 0;
#X connect 6 0 21 0;
#X connect 7 0 22 0;
#X connect 8 0 11 0;
#X connect 9 0 15 0;
#X connect 10 0 16 0;
#X connect 11 0 10 0;
#X connect 13 0 14 2;
#X connect 14 0 24 0;
#X connect 15 0 8 0;
#X connect 15 0 12 0;
#X connect 16 0 1 0;
#X connect 17 0 2 0;
#X connect 18 0 3 0;
#X connect 19 0 5 0;
#X connect 20 0 6 0;
#X connect 21 0 7 0;
#X connect 22 0 4 0;
#X connect 23 0 14 0;
#X restore 13 387 pd someGeos;
#X text 147 328 Renders depth buffer;
#X text 175 353 Renders current scene;
#X text 430 201 Two modes available:;
#X obj 435 229 vradio 20 1 0 2 empty empty empty 0 -8 0 10 -257985
-1 -1 0;
#X text 468 250 Blur mask mode;
#X text 468 229 Depth buffer mode;
#N canvas 454 181 429 272 setMode 0;
#X obj 45 10 inlet;
#X obj 45 42 sel 0;
#X msg 45 161 bgl_RenderedTexture 1 \, bgl_DepthTexture 2 \, focus
0.25;
#X text 151 57 2 Change texunit arguments for the shader;
#N canvas 0 22 650 398 guistuff 0;
#X obj 18 20 loadbang;
#X obj 77 20 inlet;
#X obj 310 22 inlet;
#X obj 77 83 s blurMask.gui;
#X msg 339 54 color 15 22 0;
#X msg 77 57 color 21 21 0;
#X obj 339 79 s blurMask.gui;
#X msg 310 109 \; texunit3.label 1 1 1 \; texunit1.label 1 1 1 \; texunit2.label
0.2 0.2 0.2;
#X msg 17 106 \; texunit3.label 0.2 0.2 0.2 \; texunit1.label 1 1 1
\; texunit2.label 1 1 1;
#X connect 0 0 8 0;
#X connect 1 0 8 0;
#X connect 1 0 5 0;
#X connect 2 0 7 0;
#X connect 2 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 3 0;
#X restore 28 71 pd guistuff;
#X text 152 37 1 Set some GUI stuff;
#X obj 45 230 s bokeh[1].args;
#X msg 72 131 bgl_RenderedTexture 1 \, bgl_DepthTexture 0 \, focus
0.25;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 4 0;
#X connect 1 1 7 0;
#X connect 1 1 4 1;
#X connect 2 0 6 0;
#X connect 7 0 6 0;
#X restore 435 276 pd setMode;
#X text 429 88 http://artmartinsh.blogspot.com/;
#X obj 13 183 pix_texture;
#X obj 121 74 hsl 128 15 0 1 0 0 empty focus.gui Focus 45 8 0 10 -257985
-1 -1 3175 1;
#X obj 13 206 translateXYZ -1.22 0 0;
#X obj 13 161 pix_shader bokeh 1;
#X obj 263 74 hsl 128 15 0 0.1 0 0 empty bias.gui Bias 50 8 0 10 -257985
-1 -1 8890 1;
#X msg 260 94 bias \$1;
#N canvas 0 22 463 177 loadDefaultSettings 0;
#X obj 25 28 inlet;
#X msg 67 73 bgl_RenderedTexture 1 \, bgl_DepthTexture 2 \, focus 0.25
\, bias 0.07;
#X obj 23 136 outlet;
#X text 116 29 These are the default settings for the bokeh shader
;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 142 161 pd loadDefaultSettings;
#X obj 13 230 square 4;
#X text 431 309 If in Blur mask mode you can change;
#X text 431 325 the blur mask. You can also load a new;
#X text 431 341 image. Gradients works nicely.;
#X text 91 386 <-- Here you can find the GEM scene;
#X text 116 402 do whatever you want there!;
#X text 121 22 First thing \, create a gem window.;
#N canvas 187 126 389 323 more 0;
#X text 19 61 MacOSX 10.5.8 nVidia GeForce 9400M;
#X text 19 217 This work is licensed by:;
#X text 19 236 Creative Commons Attribution-NonCommercial-ShareAlike
3;
#X text 19 255 http://creativecommons.org/licenses/by-nc-sa/3.0/;
#X text 19 185 Version 0.0.3;
#X text 18 18 Tested and working on:;
#X text 19 286 The font included "vera.ttf" is public domain / GNU
GPL;
#X text 18 44 Pd-extended 0.42.5 with Gem 0.92.3;
#X text 18 136 Pd-extended 0.43.1 with Gem 0.93 SVN;
#X text 18 89 Pd-extended 0.43.1 with Gem 0.93.1;
#X text 18 106 Windows 7 64bit;
#X text 18 152 Ubuntu Natty x86 64bit;
#X restore 431 165 pd more;
#X text 429 68 Bokeh GLSL Shader by Martins Upitis;
#X text 428 17 Depth of Field simulation by Guido;
#X text 429 37 http://guidotamino.it/projects/depth-of-field/;
#X obj 13 275 gemhead 10;
#X obj 13 74 gemhead 15;
#N canvas 707 276 659 482 blurMask(tex0) 0;
#X obj 120 311 pix_texture;
#X obj 133 264 loadbang;
#X obj 120 238 pix_image testVignette.jpg;
#X obj 237 67 inlet;
#X msg 237 129 open testVignette.jpg;
#X msg 254 155 open testLuma.jpg;
#X msg 271 182 open testStripes.jpg;
#N canvas 562 107 321 484 previewWindow[mask] 0;
#X obj 53 134 square 1.2;
#X obj 40 406 text3d;
#X obj 40 170 gemhead;
#X obj 147 267 loadbang;
#X obj 40 215 color 1 1 1;
#X obj 40 240 translateXYZ 4 -1.16 0;
#X obj 53 111 translateXYZ 4 0.14 0;
#X msg 114 358 3;
#X msg 63 338 font vera.ttf;
#X obj 148 286 t b b b;
#X obj 52 49 inlet;
#X msg 148 358 text TEXUNIT 3;
#X obj 103 170 r texunit3.label;
#X connect 2 0 4 0;
#X connect 3 0 9 0;
#X connect 4 0 5 0;
#X connect 5 0 1 0;
#X connect 6 0 0 0;
#X connect 7 0 1 1;
#X connect 8 0 1 0;
#X connect 9 0 11 0;
#X connect 9 1 7 0;
#X connect 9 2 8 0;
#X connect 10 0 6 0;
#X connect 11 0 1 0;
#X connect 12 0 4 1;
#X restore 120 340 pd previewWindow[mask];
#X obj 237 99 sel 0 1 2;
#X obj 120 102 gemhead 5;
#X msg 133 285 rectangle 1 \, texunit 0;
#X connect 0 0 7 0;
#X connect 1 0 10 0;
#X connect 2 0 0 0;
#X connect 3 0 8 0;
#X connect 4 0 2 0;
#X connect 5 0 2 0;
#X connect 6 0 2 0;
#X connect 8 0 4 0;
#X connect 8 1 5 0;
#X connect 8 2 6 0;
#X connect 9 0 2 0;
#X connect 10 0 0 0;
#X restore 434 399 pd blurMask(tex0);
#X text 430 116 Debugging and further improvementes by Pob;
#X text 431 136 http://puffskydd.free.fr/poby/index.html;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 1 0 7 0;
#X connect 2 0 7 0;
#X connect 3 0 36 0;
#X connect 5 0 4 0;
#X connect 6 0 19 1;
#X connect 11 0 14 0;
#X connect 16 0 18 0;
#X connect 17 0 6 0;
#X connect 18 0 23 0;
#X connect 19 0 16 0;
#X connect 19 1 22 0;
#X connect 20 0 21 0;
#X connect 21 0 19 1;
#X connect 22 0 19 1;
#X connect 34 0 0 0;
#X connect 35 0 19 0;
